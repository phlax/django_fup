var qq=function(a){return{hide:function(){a.style.display="none";return this},attach:function(c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}return function(){qq(a).detach(c,b)}},detach:function(c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}return this},contains:function(b){if(a===b){return true}if(a.contains){return a.contains(b)}else{return !!(b.compareDocumentPosition(a)&8)}},insertBefore:function(b){b.parentNode.insertBefore(a,b);return this},remove:function(){a.parentNode.removeChild(a);return this},css:function(b){if(b.opacity!==null){if(typeof a.style.opacity!=="string"&&typeof(a.filters)!=="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"}}qq.extend(a.style,b);return this},hasClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");return c.test(a.className)},addClass:function(b){if(!qq(a).hasClass(b)){a.className+=" "+b}return this},removeClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");a.className=a.className.replace(c," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(c){var d,b=[];if(a.querySelectorAll){return a.querySelectorAll("."+c)}d=a.getElementsByTagName("*");qq.each(d,function(e,f){if(qq(f).hasClass(c)){b.push(f)}});return b},children:function(){var b=[],c=a.firstChild;while(c){if(c.nodeType===1){b.push(c)}c=c.nextSibling}return b},setText:function(b){a.innerText=b;a.textContent=b;return this},clearText:function(){return qq(a).setText("")}}};qq.log=function(a,b){if(window.console){if(!b||b==="info"){window.console.log(a)}else{if(window.console[b]){window.console[b](a)}else{window.console.log("<"+b+"> "+a)}}}};qq.isObject=function(a){return a!==null&&a&&typeof(a)==="object"&&a.constructor===Object};qq.isFunction=function(a){return typeof(a)==="function"};qq.trimStr=function(a){if(String.prototype.trim){return a.trim()}return a.replace(/^\s+|\s+$/g,"")};qq.isFileOrInput=function(a){if(qq.isBlob(a)&&window.File&&a instanceof File){return true}else{if(window.HTMLInputElement){if(a instanceof HTMLInputElement){if(a.type&&a.type.toLowerCase()==="file"){return true}}}else{if(a.tagName){if(a.tagName.toLowerCase()==="input"){if(a.type&&a.type.toLowerCase()==="file"){return true}}}}}return false};qq.isBlob=function(a){return window.Blob&&a instanceof Blob};qq.isXhrUploadSupported=function(){var a=document.createElement("input");a.type="file";return(a.multiple!==undefined&&typeof File!=="undefined"&&typeof FormData!=="undefined"&&typeof(new XMLHttpRequest()).upload!=="undefined")};qq.isFolderDropSupported=function(a){return(a.items&&a.items[0].webkitGetAsEntry)};qq.isFileChunkingSupported=function(){return !qq.android()&&qq.isXhrUploadSupported()&&(File.prototype.slice||File.prototype.webkitSlice||File.prototype.mozSlice)};qq.extend=function(c,b,a){qq.each(b,function(e,d){if(a&&qq.isObject(d)){if(c[e]===undefined){c[e]={}}qq.extend(c[e],d,true)}else{c[e]=d}})};qq.indexOf=function(b,c,d){if(b.indexOf){return b.indexOf(c,d)}d=d||0;var a=b.length;if(d<0){d+=a}for(;d<a;d+=1){if(b.hasOwnProperty(d)&&b[d]===c){return d}}return -1};qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d=="x"?b:(b&3|8);return a.toString(16)})};qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.safari=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1};qq.chrome=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Google")!==-1};qq.firefox=function(){return(navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==undefined&&navigator.vendor==="")};qq.windows=function(){return navigator.platform==="Win32"};qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}}());qq.each=function(c,d){var a,b;if(c){for(a in c){if(Object.prototype.hasOwnProperty.call(c,a)){b=d(a,c[a]);if(b===false){break}}}}};qq.obj2url=function(f,b,h){var c,a,g=[],d="&",e=function(k,j){var l=b?(/\[\]$/.test(b))?b:b+"["+j+"]":j;if((l!=="undefined")&&(j!=="undefined")){g.push((typeof k==="object")?qq.obj2url(k,l,true):(Object.prototype.toString.call(k)==="[object Function]")?encodeURIComponent(l)+"="+encodeURIComponent(k()):encodeURIComponent(l)+"="+encodeURIComponent(k))}};if(!h&&b){d=(/\?/.test(b))?(/\?$/.test(b))?"":"&":"?";g.push(b);g.push(qq.obj2url(f))}else{if((Object.prototype.toString.call(f)==="[object Array]")&&(typeof f!=="undefined")){for(c=-1,a=f.length;c<a;c+=1){e(f[c],c)}}else{if((typeof f!=="undefined")&&(f!==null)&&(typeof f==="object")){for(c in f){if(f.hasOwnProperty(c)){e(f[c],c)}}}else{g.push(encodeURIComponent(b)+"="+encodeURIComponent(f))}}}if(b){return g.join(d)}else{return g.join(d).replace(/^&/,"").replace(/%20/g,"+")}};qq.obj2FormData=function(c,b,a){if(!b){b=new FormData()}qq.each(c,function(d,e){d=a?a+"["+d+"]":d;if(qq.isObject(e)){qq.obj2FormData(e,b,d)}else{if(qq.isFunction(e)){b.append(d,e())}else{b.append(d,e)}}});return b};qq.obj2Inputs=function(c,b){var a;if(!b){b=document.createElement("form")}qq.obj2FormData(c,{append:function(d,e){a=document.createElement("input");a.setAttribute("name",d);a.setAttribute("value",e);b.appendChild(a)}});return b};qq.setCookie=function(c,d,e){var b=new Date(),a="";if(e){b.setTime(b.getTime()+(e*24*60*60*1000));a="; expires="+b.toGMTString()}document.cookie=c+"="+d+a+"; path=/"};qq.getCookie=function(b){var e=b+"=",a=document.cookie.split(";"),f;for(var d=0;d<a.length;d++){f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)===0){return f.substring(e.length,f.length)}}};qq.getCookieNames=function(b){var a=document.cookie.split(";"),c=[];qq.each(a,function(d,e){e=qq.trimStr(e);var f=e.indexOf("=");if(e.match(b)){c.push(e.substr(0,f))}});return c};qq.deleteCookie=function(a){qq.setCookie(a,"",-1)};qq.areCookiesEnabled=function(){var b=Math.random()*100000,a="qqCookieTest:"+b;qq.setCookie(a,1);if(qq.getCookie(a)){qq.deleteCookie(a);return true}return false};qq.parseJson=function(json){if(window.JSON&&qq.isFunction(JSON.parse)){return JSON.parse(json)}else{return eval("("+json+")")}};qq.DisposeSupport=function(){var a=[];return{dispose:function(){var b;do{b=a.shift();if(b){b()}}while(b)},attach:function(){var b=arguments;this.addDisposer(qq(b[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(b){a.push(b)}}};qq.UploadButton=function(a){this._options={element:null,multiple:false,acceptFiles:null,name:"file",onChange:function(b){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);this._disposeSupport=new qq.DisposeSupport();this._element=this._options.element;qq(this._element).css({position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode){qq(this._input).remove()}qq(this._element).removeClass(this._options.focusClass);this._input=this._createInput()},_createInput:function(){var b=document.createElement("input");if(this._options.multiple){b.setAttribute("multiple","multiple")}if(this._options.acceptFiles){b.setAttribute("accept",this._options.acceptFiles)}b.setAttribute("type","file");b.setAttribute("name",this._options.name);qq(b).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});this._element.appendChild(b);var a=this;this._disposeSupport.attach(b,"change",function(){a._options.onChange(b)});this._disposeSupport.attach(b,"mouseover",function(){qq(a._element).addClass(a._options.hoverClass)});this._disposeSupport.attach(b,"mouseout",function(){qq(a._element).removeClass(a._options.hoverClass)});this._disposeSupport.attach(b,"focus",function(){qq(a._element).addClass(a._options.focusClass)});this._disposeSupport.attach(b,"blur",function(){qq(a._element).removeClass(a._options.focusClass)});if(window.attachEvent){b.setAttribute("tabIndex","-1")}return b}};qq.FineUploaderBasic=function(b){var a=this;this._options={debug:false,button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:false,autoUpload:true,request:{endpoint:"/server/upload",params:{},paramsInBody:true,customHeaders:{},forceMultipart:true,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,stopOnFirstInvalidFile:true},callbacks:{onSubmit:function(d,c){},onComplete:function(e,c,d){},onCancel:function(d,c){},onUpload:function(d,c){},onUploadChunk:function(e,d,c){},onResume:function(e,d,c){},onProgress:function(f,d,c,e){},onError:function(e,c,d){},onAutoRetry:function(e,c,d){},onManualRetry:function(d,c){},onValidateBatch:function(c){},onValidate:function(c){},onSubmitDelete:function(c){},onDelete:function(c){},onDeleteComplete:function(e,d,c){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:false,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:false,partSize:2000000,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(c){if(c.length>33){c=c.slice(0,19)+"..."+c.slice(-14)}return c},text:{sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:false,endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:false,sendCredentials:false},blobs:{defaultName:"Misc data",paramNames:{name:"qqblobname"}}};qq.extend(this._options,b,true);this._wrapCallbacks();this._disposeSupport=new qq.DisposeSupport();this._filesInProgress=[];this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._paramsStore=this._createParamsStore("request");this._deleteFileParamsStore=this._createParamsStore("deleteFile");this._endpointStore=this._createEndpointStore("request");this._deleteFileEndpointStore=this._createEndpointStore("deleteFile");this._handler=this._createUploadHandler();this._deleteHandler=this._createDeleteHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}this._preventLeaveInProgress()};qq.FineUploaderBasic.prototype={log:function(a,b){if(this._options.debug&&(!b||b==="info")){qq.log("[FineUploader] "+a)}else{if(b&&b!=="info"){qq.log("[FineUploader] "+a,b)}}},setParams:function(a,b){if(b==null){this._options.request.params=a}else{this._paramsStore.setParams(a,b)}},setDeleteFileParams:function(a,b){if(b==null){this._options.deleteFile.params=a}else{this._deleteFileParamsStore.setParams(a,b)}},setEndpoint:function(a,b){if(b==null){this._options.request.endpoint=a}else{this._endpointStore.setEndpoint(a,b)}},getInProgress:function(){return this._filesInProgress.length},uploadStoredFiles:function(){var a;while(this._storedIds.length){a=this._storedIds.shift();this._filesInProgress.push(a);this._handler.upload(a)}},clearStoredFiles:function(){this._storedIds=[]},retry:function(a){if(this._onBeforeManualRetry(a)){this._handler.retry(a);return true}else{return false}},cancel:function(a){this._handler.cancel(a)},cancelAll:function(){var b=[],a=this;qq.extend(b,this._storedIds);qq.each(b,function(c,d){a.cancel(d)});this._handler.cancelAll()},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._filesInProgress=[];this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._button.reset();this._paramsStore.reset();this._endpointStore.reset()},addFiles:function(d){var a=this,e=[],b,c;if(d){if(!window.FileList||!(d instanceof FileList)){d=[].concat(d)}for(b=0;b<d.length;b+=1){c=d[b];if(qq.isFileOrInput(c)){e.push(c)}else{a.log(c+" is not a File or INPUT element!  Ignoring!","warn")}}this.log("Processing "+e.length+" files or inputs...");this._uploadFileOrBlobDataList(e)}},addBlobs:function(d){if(d){var c=[].concat(d),b=[],a=this;qq.each(c,function(e,f){if(qq.isBlob(f)&&!qq.isFileOrInput(f)){b.push({blob:f,name:a._options.blobs.defaultName})}else{if(qq.isObject(f)&&f.blob&&f.name){b.push(f)}else{a.log("addBlobs: entry at index "+e+" is not a Blob or a BlobData object","error")}}});this._uploadFileOrBlobDataList(b)}else{this.log("undefined or non-array parameter passed into addBlobs","error")}},getUuid:function(a){return this._handler.getUuid(a)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(a){return this._handler.getSize(a)},getFile:function(a){return this._handler.getFile(a)},deleteFile:function(a){this._onSubmitDelete(a)},setDeleteFileEndpoint:function(a,b){if(b==null){this._options.deleteFile.endpoint=a}else{this._deleteFileEndpointStore.setEndpoint(a,b)}},_createUploadButton:function(c){var a=this;var b=new qq.UploadButton({element:c,multiple:this._options.multiple&&qq.isXhrUploadSupported(),acceptFiles:this._options.validation.acceptFiles,onChange:function(d){a._onInputChange(d)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});this._disposeSupport.addDisposer(function(){b.dispose()});return b},_createUploadHandler:function(){var a=this;return new qq.UploadHandler({debug:this._options.debug,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,uuidParamName:this._options.request.uuidName,totalFileSizeParamName:this._options.request.totalFileSizeName,cors:this._options.cors,demoMode:this._options.demoMode,paramsInBody:this._options.request.paramsInBody,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:function(b,c){a.log(b,c)},onProgress:function(e,c,b,d){a._onProgress(e,c,b,d);a._options.callbacks.onProgress(e,c,b,d)},onComplete:function(e,c,b,d){a._onComplete(e,c,b,d);a._options.callbacks.onComplete(e,c,b)},onCancel:function(c,b){a._onCancel(c,b);a._options.callbacks.onCancel(c,b)},onUpload:function(c,b){a._onUpload(c,b);a._options.callbacks.onUpload(c,b)},onUploadChunk:function(d,c,b){a._options.callbacks.onUploadChunk(d,c,b)},onResume:function(d,c,b){return a._options.callbacks.onResume(d,c,b)},onAutoRetry:function(e,b,d,c){a._preventRetries[e]=d[a._options.retry.preventRetryResponseProperty];if(a._shouldAutoRetry(e,b,d)){a._maybeParseAndSendUploadError(e,b,d,c);a._options.callbacks.onAutoRetry(e,b,a._autoRetries[e]+1);a._onBeforeAutoRetry(e,b);a._retryTimeouts[e]=setTimeout(function(){a._onAutoRetry(e,b,d)},a._options.retry.autoAttemptDelay*1000);return true}else{return false}}})},_createDeleteHandler:function(){var a=this;return new qq.DeleteFileAjaxRequestor({maxConnections:this._options.maxConnections,customHeaders:this._options.deleteFile.customHeaders,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:function(b,c){a.log(b,c)},onDelete:function(b){a._onDelete(b);a._options.callbacks.onDelete(b)},onDeleteComplete:function(d,c,b){a._onDeleteComplete(d,c,b);a._options.callbacks.onDeleteComplete(d,c,b)}})},_preventLeaveInProgress:function(){var a=this;this._disposeSupport.attach(window,"beforeunload",function(b){if(!a._filesInProgress.length){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(b,a){if(this._options.autoUpload){this._filesInProgress.push(b)}},_onProgress:function(d,b,a,c){},_onComplete:function(d,b,a,c){this._removeFromFilesInProgress(d);this._maybeParseAndSendUploadError(d,b,a,c)},_onCancel:function(c,a){this._removeFromFilesInProgress(c);clearTimeout(this._retryTimeouts[c]);var b=qq.indexOf(this._storedIds,c);if(!this._options.autoUpload&&b>=0){this._storedIds.splice(b,1)}},_isDeletePossible:function(){return(this._options.deleteFile.enabled&&(!this._options.cors.expected||(this._options.cors.expected&&(qq.ie10()||!qq.ie()))))},_onSubmitDelete:function(a){if(this._isDeletePossible()){if(this._options.callbacks.onSubmitDelete(a)){this._deleteHandler.sendDelete(a,this.getUuid(a))}}else{this.log("Delete request ignored for ID "+a+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn");return false}},_onDelete:function(a){},_onDeleteComplete:function(d,c,b){var a=this._handler.getName(d);if(b){this.log("Delete request for '"+a+"' has failed.","error");this._options.callbacks.onError(d,a,"Delete request failed with response code "+c.status)}else{this.log("Delete request for '"+a+"' has succeeded.")}},_removeFromFilesInProgress:function(b){var a=qq.indexOf(this._filesInProgress,b);if(a>=0){this._filesInProgress.splice(a,1)}},_onUpload:function(b,a){},_onInputChange:function(a){if(qq.isXhrUploadSupported()){this.addFiles(a.files)}else{this.addFiles(a)}this._button.reset()},_onBeforeAutoRetry:function(b,a){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+a+"...")},_onAutoRetry:function(c,a,b){this.log("Retrying "+a+"...");this._autoRetries[c]++;this._handler.retry(c)},_shouldAutoRetry:function(c,a,b){if(!this._preventRetries[c]&&this._options.retry.enableAuto){if(this._autoRetries[c]===undefined){this._autoRetries[c]=0}return this._autoRetries[c]<this._options.retry.maxAutoAttempts}return false},_onBeforeManualRetry:function(b){if(this._preventRetries[b]){this.log("Retries are forbidden for id "+b,"warn");return false}else{if(this._handler.isValid(b)){var a=this._handler.getName(b);if(this._options.callbacks.onManualRetry(b,a)===false){return false}this.log("Retrying upload for '"+a+"' (id: "+b+")...");this._filesInProgress.push(b);return true}else{this.log("'"+b+"' is not a valid file ID","error");return false}}},_maybeParseAndSendUploadError:function(e,c,b,d){if(!b.success){if(d&&d.status!==200&&!b.error){this._options.callbacks.onError(e,c,"XHR returned response code "+d.status)}else{var a=b.error?b.error:"Upload failure reason unknown";this._options.callbacks.onError(e,c,a)}}},_uploadFileOrBlobDataList:function(a){var d,b,c;d=this._getValidationDescriptors(a);c=this._options.callbacks.onValidateBatch(d)===false;if(!c){if(a.length>0){for(b=0;b<a.length;b++){if(this._validateFileOrBlobData(a[b])){this._upload(a[b])}else{if(this._options.validation.stopOnFirstInvalidFile){return}}}}else{this._error("noFilesError","")}}},_upload:function(b){var c=this._handler.add(b);var a=this._handler.getName(c);if(this._options.callbacks.onSubmit(c,a)!==false){this._onSubmit(c,a);if(this._options.autoUpload){this._handler.upload(c)}else{this._storeForLater(c)}}},_storeForLater:function(a){this._storedIds.push(a)},_validateFileOrBlobData:function(a){var b,c,d;b=this._getValidationDescriptor(a);c=b.name;d=b.size;if(this._options.callbacks.onValidate(b)===false){return false}if(qq.isFileOrInput(a)&&!this._isAllowedExtension(c)){this._error("typeError",c);return false}else{if(d===0){this._error("emptyError",c);return false}else{if(d&&this._options.validation.sizeLimit&&d>this._options.validation.sizeLimit){this._error("sizeError",c);return false}else{if(d&&d<this._options.validation.minSizeLimit){this._error("minSizeError",c);return false}}}}return true},_error:function(e,a){var d=this._options.messages[e];function c(f,g){d=d.replace(f,g)}var b=this._options.validation.allowedExtensions.join(", ").toLowerCase();c("{file}",this._options.formatFileName(a));c("{extensions}",b);c("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit));c("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit));this._options.callbacks.onError(null,a,d);return d},_isAllowedExtension:function(c){var b=this._options.validation.allowedExtensions,a=false;if(!b.length){return true}qq.each(b,function(d,f){var e=new RegExp("\\."+f+"$","i");if(c.match(e)!=null){a=true;return false}});return a},_formatSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.1).toFixed(1)+this._options.text.sizeSymbols[b]},_wrapCallbacks:function(){var a,b;a=this;b=function(e,g,d){try{return g.apply(a,d)}catch(f){a.log("Caught exception in '"+e+"' callback - "+f.message,"error")}};for(var c in this._options.callbacks){(function(){var e,d;e=c;d=a._options.callbacks[e];a._options.callbacks[e]=function(){return b(e,d,arguments)}}())}},_parseFileOrBlobDataName:function(a){var b;if(qq.isFileOrInput(a)){if(a.value){b=a.value.replace(/.*(\/|\\)/,"")}else{b=(a.fileName!==null&&a.fileName!==undefined)?a.fileName:a.name}}else{b=a.name}return b},_parseFileOrBlobDataSize:function(a){var b;if(qq.isFileOrInput(a)){if(!a.value){b=(a.fileSize!==null&&a.fileSize!==undefined)?a.fileSize:a.size}}else{b=a.blob.size}return b},_getValidationDescriptor:function(a){var c,d,b;b={};c=this._parseFileOrBlobDataName(a);d=this._parseFileOrBlobDataSize(a);b.name=c;if(d){b.size=d}return b},_getValidationDescriptors:function(b){var a=this,c=[];qq.each(b,function(d,e){c.push(a._getValidationDescriptor(e))});return c},_createParamsStore:function(c){var a={},b=this;return{setParams:function(e,f){var d={};qq.extend(d,e);a[f]=d},getParams:function(e){var d={};if(e!=null&&a[e]){qq.extend(d,a[e])}else{qq.extend(d,b._options[c].params)}return d},remove:function(d){return delete a[d]},reset:function(){a={}}}},_createEndpointStore:function(b){var c={},a=this;return{setEndpoint:function(d,e){c[e]=d},getEndpoint:function(d){if(d!=null&&c[d]){return c[d]}return a._options[b].endpoint},remove:function(d){return delete c[d]},reset:function(){c={}}}}};qq.DragAndDrop=function(d){var p,n,m,b=[],j=0,e=0,l=new qq.DisposeSupport();p={dropArea:null,extraDropzones:[],hideDropzones:true,multiple:true,classes:{dropActive:null},callbacks:{dropProcessing:function(o,q){},error:function(q,o){},log:function(o,q){}}};qq.extend(p,d);function a(){if(j===e&&!m){p.callbacks.log("Grabbed "+b.length+" files after tree traversal.");n.dropDisabled(false);p.callbacks.dropProcessing(false,b)}}function g(o){b.push(o);e+=1;a()}function h(r){var q,o;j+=1;if(r.isFile){r.file(function(s){g(s)})}else{if(r.isDirectory){m=true;q=r.createReader();q.readEntries(function(s){e+=1;for(o=0;o<s.length;o+=1){h(s[o])}m=false;if(!s.length){a()}})}}}function k(s){var q,o,r;p.callbacks.dropProcessing(true);n.dropDisabled(true);if(s.files.length>1&&!p.multiple){p.callbacks.dropProcessing(false);p.callbacks.error("tooManyFilesError","");n.dropDisabled(false)}else{b=[];j=0;e=0;if(qq.isFolderDropSupported(s)){o=s.items;for(q=0;q<o.length;q+=1){r=o[q].webkitGetAsEntry();if(r){if(r.isFile){b.push(o[q].getAsFile());if(q===o.length-1){a()}}else{h(r)}}}}else{p.callbacks.dropProcessing(false,s.files);n.dropDisabled(false)}}}function c(o){n=new qq.UploadDropZone({element:o,onEnter:function(q){qq(o).addClass(p.classes.dropActive);q.stopPropagation()},onLeaveNotDescendants:function(q){qq(o).removeClass(p.classes.dropActive)},onDrop:function(q){if(p.hideDropzones){qq(o).hide()}qq(o).removeClass(p.classes.dropActive);k(q.dataTransfer)}});l.addDisposer(function(){n.dispose()});if(p.hideDropzones){qq(o).hide()}}function i(q){var o;qq.each(q.dataTransfer.types,function(r,s){if(s==="Files"){o=true;return false}});return o}function f(){if(p.dropArea){p.extraDropzones.push(p.dropArea)}var o,q=p.extraDropzones;for(o=0;o<q.length;o+=1){c(q[o])}if(p.dropArea&&(!qq.ie()||qq.ie10())){l.attach(document,"dragenter",function(r){if(!n.dropDisabled()&&i(r)){if(qq(p.dropArea).hasClass(p.classes.dropDisabled)){return}p.dropArea.style.display="block";for(o=0;o<q.length;o+=1){q[o].style.display="block"}}})}l.attach(document,"dragleave",function(r){if(p.hideDropzones&&qq.FineUploader.prototype._leaving_document_out(r)){for(o=0;o<q.length;o+=1){qq(q[o]).hide()}}});l.attach(document,"drop",function(r){if(p.hideDropzones){for(o=0;o<q.length;o+=1){qq(q[o]).hide()}}r.preventDefault()})}return{setup:function(){f()},setupExtraDropzone:function(o){p.extraDropzones.push(o);c(o)},removeExtraDropzone:function(r){var q,o=p.extraDropzones;for(q in o){if(o[q]===r){return o.splice(q,1)}}},dispose:function(){l.dispose();n.dispose()}}};qq.UploadDropZone=function(c){var k,e,i,f,h=new qq.DisposeSupport();k={element:null,onEnter:function(l){},onLeave:function(l){},onLeaveNotDescendants:function(l){},onDrop:function(l){}};qq.extend(k,c);e=k.element;function a(){return qq.safari()||(qq.firefox()&&qq.windows())}function d(l){if(!f){if(a){h.attach(document,"dragover",function(m){m.preventDefault()})}else{h.attach(document,"dragover",function(m){if(m.dataTransfer){m.dataTransfer.dropEffect="none";m.preventDefault()}})}f=true}}function b(o){if(qq.ie()&&!qq.ie10()){return false}var n,m=o.dataTransfer,l=qq.safari();n=qq.ie10()?true:m.effectAllowed!=="none";return m&&n&&(m.files||(!l&&m.types.contains&&m.types.contains("Files")))}function j(l){if(l!==undefined){i=l}return i}function g(){h.attach(e,"dragover",function(m){if(!b(m)){return}var l=qq.ie()?null:m.dataTransfer.effectAllowed;if(l==="move"||l==="linkMove"){m.dataTransfer.dropEffect="move"}else{m.dataTransfer.dropEffect="copy"}m.stopPropagation();m.preventDefault()});h.attach(e,"dragenter",function(l){if(!j()){if(!b(l)){return}k.onEnter(l)}});h.attach(e,"dragleave",function(m){if(!b(m)){return}k.onLeave(m);var l=document.elementFromPoint(m.clientX,m.clientY);if(qq(this).contains(l)){return}k.onLeaveNotDescendants(m)});h.attach(e,"drop",function(l){if(!j()){if(!b(l)){return}l.preventDefault();k.onDrop(l)}})}d();g();return{dropDisabled:function(l){return j(l)},dispose:function(){h.dispose()}}};qq.FineUploader=function(a){qq.FineUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:true,disableDefaultDropzone:false},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",deleteButton:"Delete",failUpload:"Upload failed",dragZone:"Drop files here to upload",dropProcessing:"Processing dropped files...",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="qq-uploader">'+((!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone)?'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>':"")+(!this._options.button?'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>':"")+'<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>'+(!this._options.listElement?'<ul class="qq-upload-list"></ul>':"")+"</div>",fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><a class="qq-upload-delete" href="#">{deleteButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",deleteButton:"qq-upload-delete",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null,dropProcessing:"qq-drop-processing",dropProcessingSpinner:"qq-drop-processing-spinner"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:true},messages:{tooManyFilesError:"You may only drop one file"},retry:{showAutoRetryNote:true,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:false},deleteFile:{forceConfirm:false,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:false},showMessage:function(b){setTimeout(function(){alert(b)},0)},showConfirm:function(c,d,b){setTimeout(function(){var e=confirm(c);if(e){d()}else{if(b){b()}}},0)}},true);qq.extend(this._options,a,true);this._wrapCallbacks();this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton);this._options.template=this._options.template.replace(/\{dropProcessingText\}/g,this._options.text.dropProcessing);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{deleteButtonText\}/g,this._options.text.deleteButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,"");this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;if(!this._button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._dnd=this._setupDragAndDrop()};qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype);qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments);this._listElement.innerHTML=""},addExtraDropzone:function(a){this._dnd.setupExtraDropzone(a)},removeExtraDropzone:function(a){return this._dnd.removeExtraDropzone(a)},getItemByFileId:function(b){var a=this._listElement.firstChild;while(a){if(a.qqFileId==b){return a}a=a.nextSibling}},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments);this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");if(!this._options.button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._dnd.dispose();this._dnd=this._setupDragAndDrop()},_removeFileItem:function(a){var b=this.getItemByFileId(a);qq(b).remove()},_setupDragAndDrop:function(){var a=this,e=this._find(this._element,"dropProcessing"),c,d,b;d=function(f){f.preventDefault()};if(!this._options.dragAndDrop.disableDefaultDropzone){b=this._find(this._options.element,"drop")}c=new qq.DragAndDrop({dropArea:b,extraDropzones:this._options.dragAndDrop.extraDropzones,hideDropzones:this._options.dragAndDrop.hideDropzones,multiple:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{dropProcessing:function(g,h){var f=a._button.getInput();if(g){qq(e).css({display:"block"});qq(f).attach("click",d)}else{qq(e).hide();qq(f).detach("click",d)}if(h){a.addFiles(h)}},error:function(g,f){a._error(g,f)},log:function(f,g){a.log(f,g)}}});c.setup();return c},_leaving_document_out:function(a){return((qq.chrome()||(qq.safari()&&qq.windows()))&&a.clientX==0&&a.clientY==0)||(qq.firefox()&&!a.relatedTarget)},_storeForLater:function(b){qq.FineUploaderBasic.prototype._storeForLater.apply(this,arguments);var a=this.getItemByFileId(b);qq(this._find(a,"spinner")).hide()},_find:function(c,b){var a=qq(c).getByClass(this._options.classes[b])[0];if(!a){throw new Error("element not found "+b)}return a},_onSubmit:function(b,a){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(b,a)},_onProgress:function(h,c,b,f){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var e,g,d,a;e=this.getItemByFileId(h);g=this._find(e,"progressBar");d=Math.round(b/f*100);if(b===f){a=this._find(e,"cancel");qq(a).hide();qq(g).hide();qq(this._find(e,"statusText")).setText(this._options.text.waitingForResponse);this._displayFileSize(h)}else{this._displayFileSize(h,b,f);qq(g).css({display:"block"})}qq(g).css({width:d+"%"})},_onComplete:function(e,b,a,d){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var c=this.getItemByFileId(e);qq(this._find(c,"statusText")).clearText();qq(c).removeClass(this._classes.retrying);qq(this._find(c,"progressBar")).hide();if(!this._options.disableCancelForFormUploads||qq.isXhrUploadSupported()){qq(this._find(c,"cancel")).hide()}qq(this._find(c,"spinner")).hide();if(a.success){if(this._isDeletePossible()){this._showDeleteLink(e)}qq(c).addClass(this._classes.success);if(this._classes.successIcon){this._find(c,"finished").style.display="inline-block";qq(c).addClass(this._classes.successIcon)}}else{qq(c).addClass(this._classes.fail);if(this._classes.failIcon){this._find(c,"finished").style.display="inline-block";qq(c).addClass(this._classes.failIcon)}if(this._options.retry.showButton&&!this._preventRetries[e]){qq(c).addClass(this._classes.retryable)}this._controlFailureTextDisplay(c,a)}},_onUpload:function(b,a){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);this._showSpinner(b)},_onCancel:function(b,a){qq.FineUploaderBasic.prototype._onCancel.apply(this,arguments);this._removeFileItem(b)},_onBeforeAutoRetry:function(g){var d,f,a,e,c,b;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments);d=this.getItemByFileId(g);f=this._find(d,"progressBar");this._showCancelLink(d);f.style.width=0;qq(f).hide();if(this._options.retry.showAutoRetryNote){a=this._find(d,"statusText");e=this._autoRetries[g]+1;c=this._options.retry.maxAutoAttempts;b=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,e);b=b.replace(/\{maxAuto\}/g,c);qq(a).setText(b);if(e===1){qq(d).addClass(this._classes.retrying)}}},_onBeforeManualRetry:function(b){if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){var a=this.getItemByFileId(b);this._find(a,"progressBar").style.width=0;qq(a).removeClass(this._classes.fail);qq(this._find(a,"statusText")).clearText();this._showSpinner(b);this._showCancelLink(a);return true}return false},_onSubmitDelete:function(a){if(this._isDeletePossible()){if(this._options.callbacks.onSubmitDelete(a)!==false){if(this._options.deleteFile.forceConfirm){this._showDeleteConfirm(a)}else{this._sendDeleteRequest(a)}}}else{this.log("Delete request ignored for file ID "+a+", delete feature is disabled.","warn");return false}},_onDeleteComplete:function(f,c,a){qq.FineUploaderBasic.prototype._onDeleteComplete.apply(this,arguments);var b=this.getItemByFileId(f),e=this._find(b,"spinner"),d=this._find(b,"statusText");qq(e).hide();if(a){qq(d).setText(this._options.deleteFile.deletingFailedText);this._showDeleteLink(f)}else{this._removeFileItem(f)}},_sendDeleteRequest:function(d){var b=this.getItemByFileId(d),a=this._find(b,"deleteButton"),c=this._find(b,"statusText");qq(a).hide();this._showSpinner(d);qq(c).setText(this._options.deleteFile.deletingStatusText);this._deleteHandler.sendDelete(d,this.getUuid(d))},_showDeleteConfirm:function(e){var d=this._handler.getName(e),c=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,d),b=this.getUuid(e),a=this;this._options.showConfirm(c,function(){a._sendDeleteRequest(e)})},_addToList:function(e,b){var c=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.isXhrUploadSupported()){var a=this._find(c,"cancel");qq(a).remove()}c.qqFileId=e;var d=this._find(c,"file");qq(d).setText(this._options.formatFileName(b));qq(this._find(c,"size")).hide();if(!this._options.multiple){this._handler.cancelAll();this._clearList()}this._listElement.appendChild(c);if(this._options.display.fileSizeOnSubmit&&qq.isXhrUploadSupported()){this._displayFileSize(e)}},_clearList:function(){this._listElement.innerHTML="";this.clearStoredFiles()},_displayFileSize:function(g,b,a){var e=this.getItemByFileId(g),c=this.getSize(g),d=this._formatSize(c),f=this._find(e,"size");if(b!==undefined&&a!==undefined){d=this._formatProgress(b,a)}qq(f).css({display:"inline"});qq(f).setText(d)},_bindCancelAndRetryEvents:function(){var a=this,b=this._listElement;this._disposeSupport.attach(b,"click",function(f){f=f||window.event;var d=f.target||f.srcElement;if(qq(d).hasClass(a._classes.cancel)||qq(d).hasClass(a._classes.retry)||qq(d).hasClass(a._classes.deleteButton)){qq.preventDefault(f);var c=d.parentNode;while(c.qqFileId===undefined){c=d=d.parentNode}if(qq(d).hasClass(a._classes.deleteButton)){a.deleteFile(c.qqFileId)}else{if(qq(d).hasClass(a._classes.cancel)){a.cancel(c.qqFileId)}else{qq(c).removeClass(a._classes.retryable);a.retry(c.qqFileId)}}}})},_formatProgress:function(d,a){var c=this._options.text.formatProgress;function b(e,f){c=c.replace(e,f)}b("{percent}",Math.round(d/a*100));b("{total_size}",this._formatSize(a));return c},_controlFailureTextDisplay:function(c,b){var f,d,a,g,e;f=this._options.failedUploadTextDisplay.mode;d=this._options.failedUploadTextDisplay.maxChars;a=this._options.failedUploadTextDisplay.responseProperty;if(f==="custom"){g=b[a];if(g){if(g.length>d){e=g.substring(0,d)+"..."}}else{g=this._options.text.failUpload;this.log("'"+a+"' is not a valid property on the server response.","warn")}qq(this._find(c,"statusText")).setText(e||g);if(this._options.failedUploadTextDisplay.enableTooltip){this._showTooltip(c,g)}}else{if(f==="default"){qq(this._find(c,"statusText")).setText(this._options.text.failUpload)}else{if(f!=="none"){this.log("failedUploadTextDisplay.mode value of '"+f+"' is not valid","warn")}}}},_showTooltip:function(a,b){a.title=b},_showSpinner:function(c){var a=this.getItemByFileId(c),b=this._find(a,"spinner");b.style.display="inline-block"},_showCancelLink:function(b){if(!this._options.disableCancelForFormUploads||qq.isXhrUploadSupported()){var a=this._find(b,"cancel");qq(a).css({display:"inline"})}},_showDeleteLink:function(c){var b=this.getItemByFileId(c),a=this._find(b,"deleteButton");qq(a).css({display:"inline"})},_error:function(c,a){var b=qq.FineUploaderBasic.prototype._error.apply(this,arguments);this._options.showMessage(b)}});qq.AjaxRequestor=function(b){var e,l,g=[],c=[],p={method:"POST",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},successfulResponseCodes:[200],demoMode:false,cors:{expected:false,sendCredentials:false},log:function(o,q){},onSend:function(o){},onComplete:function(r,q,o){},onCancel:function(o){}};qq.extend(p,b);e=p.log;l=h()==="GET"||h()==="DELETE";function j(s){var q=qq.indexOf(g,s),o=p.maxConnections,r;delete c[s];g.splice(q,1);if(g.length>=o&&q<o){r=g[o-1];a(r)}}function d(s){var q=c[s].xhr,r=h(),o=false;j(s);if(!m(q.status)){o=true;e(r+" request for "+s+" has failed - response code "+q.status,"error")}p.onComplete(s,q,o)}function a(t){var r=new XMLHttpRequest(),s=h(),q={},o;p.onSend(t);if(p.paramsStore.getParams){q=p.paramsStore.getParams(t)}o=i(t,q);c[t].xhr=r;r.onreadystatechange=f(t);r.open(s,o,true);if(p.cors.expected&&p.cors.sendCredentials){r.withCredentials=true}k(t);e("Sending "+s+" request for "+t);if(!l&&q){r.send(qq.obj2url(q,""))}else{r.send()}}function i(s,r){var q=p.endpointStore.getEndpoint(s),o=c[s].addToPath;if(o!==undefined){q+="/"+o}if(l&&r){return qq.obj2url(r,q)}else{return q}}function f(q){var o=c[q].xhr;return function(){if(o.readyState===4){d(q,o)}}}function k(r){var q=c[r].xhr,o=p.customHeaders;q.setRequestHeader("X-Requested-With","XMLHttpRequest");q.setRequestHeader("Cache-Control","no-cache");qq.each(o,function(s,t){q.setRequestHeader(s,t)})}function n(r){var o=c[r].xhr,q=h();if(o){o.onreadystatechange=null;o.abort();j(r);e("Cancelled "+q+" for "+r);p.onCancel(r);return true}return false}function m(o){return qq.indexOf(p.successfulResponseCodes,o)>=0}function h(){if(p.demoMode){return"GET"}return p.method}return{send:function(r,q){c[r]={addToPath:q};var o=g.push(r);if(o<=p.maxConnections){a(r)}},cancel:function(o){return n(o)}}};qq.DeleteFileAjaxRequestor=function(c){var b,a={endpointStore:{},maxConnections:3,customHeaders:{},paramsStore:{},demoMode:false,cors:{expected:false,sendCredentials:false},log:function(d,e){},onDelete:function(d){},onDeleteComplete:function(f,e,d){}};qq.extend(a,c);b=new qq.AjaxRequestor({method:"DELETE",endpointStore:a.endpointStore,paramsStore:a.paramsStore,maxConnections:a.maxConnections,customHeaders:a.customHeaders,successfulResponseCodes:[200,202,204],demoMode:a.demoMode,log:a.log,onSend:a.onDelete,onComplete:a.onDeleteComplete});return{sendDelete:function(e,d){b.send(e,d);a.log("Submitted delete file request for "+e)}}};qq.WindowReceiveMessage=function(b){var a={log:function(d,e){}},c={};qq.extend(a,b);return{receiveMessage:function(f,e){var d=function(g){e(g.data)};if(window.postMessage){c[f]=qq(window).attach("message",d)}else{log("iframe message passing not supported in this browser!","error")}},stopReceivingMessages:function(e){if(window.postMessage){var d=c[e];if(d){d()}}}}};qq.UploadHandler=function(f){var a=[],c,d,e,b;c={debug:false,forceMultipart:true,paramsInBody:false,paramsStore:{},endpointStore:{},cors:{expected:false,sendCredentials:false},maxConnections:3,uuidParamName:"qquuid",totalFileSizeParamName:"qqtotalfilesize",chunking:{enabled:false,partSize:2000000,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},blobs:{paramNames:{name:"qqblobname"}},log:function(g,h){},onProgress:function(j,i,g,h){},onComplete:function(j,i,g,h){},onCancel:function(h,g){},onUpload:function(h,g){},onUploadChunk:function(i,h,g){},onAutoRetry:function(j,i,g,h){},onResume:function(i,h,g){}};qq.extend(c,f);d=c.log;e=function(k){var h=qq.indexOf(a,k),g=c.maxConnections,j;if(h>=0){a.splice(h,1);if(a.length>=g&&h<g){j=a[g-1];b.upload(j)}}};if(qq.isXhrUploadSupported()){b=new qq.UploadHandlerXhr(c,e,d)}else{b=new qq.UploadHandlerForm(c,e,d)}return{add:function(g){return b.add(g)},upload:function(h){var g=a.push(h);if(g<=c.maxConnections){return b.upload(h)}},retry:function(h){var g=qq.indexOf(a,h);if(g>=0){return b.upload(h,true)}else{return this.upload(h)}},cancel:function(g){d("Cancelling "+g);c.paramsStore.remove(g);b.cancel(g);e(g)},cancelAll:function(){var g=this,h=[];qq.extend(h,a);qq.each(h,function(i,j){g.cancel(j)});a=[]},getName:function(g){return b.getName(g)},getSize:function(g){if(b.getSize){return b.getSize(g)}},getFile:function(g){if(b.getFile){return b.getFile(g)}},getQueue:function(){return a},reset:function(){d("Resetting upload handler");a=[];b.reset()},getUuid:function(g){return b.getUuid(g)},isValid:function(g){return b.isValid(g)},getResumableFilesData:function(){if(b.getResumableFilesData){return b.getResumableFilesData()}return[]}}};qq.UploadHandlerForm=function(k,t,r){var d=k,c=[],f=[],i={},p={},m=t,g=r,s=new qq.WindowReceiveMessage({log:g}),b={},j;function q(o){if(i[o]!==undefined){i[o]();delete i[o]}}function l(o,v){var u=o.id;b[f[u]]=v;i[u]=qq(o).attach("load",function(){if(c[u]){g("Received iframe load event for CORS upload request (file id "+u+")");p[u]=setTimeout(function(){var w="No valid message received from loaded iframe for file id "+u;g(w,"error");v({error:w})},1000)}});s.receiveMessage(u,function(y){g("Received the following window message: '"+y+"'");var w=qq.parseJson(y),x=w.uuid,z;if(x&&b[x]){clearTimeout(p[u]);delete p[u];q(u);z=b[x];delete b[x];s.stopReceivingMessages(u);z(w)}else{if(!x){g("'"+y+"' does not contain a UUID - ignoring.")}}})}function n(o,u){if(d.cors.expected){l(o,u)}else{i[o.id]=qq(o).attach("load",function(){g("Received response for "+o.id);if(!o.parentNode){return}try{if(o.contentDocument&&o.contentDocument.body&&o.contentDocument.body.innerHTML=="false"){return}}catch(v){g("Error when attempting to access iframe during handling of upload response ("+v+")","error")}u()})}}function e(v){var o;try{var w=v.contentDocument||v.contentWindow.document,x=w.body.innerHTML;g("converting iframe's innerHTML to JSON");g("innerHTML = "+x);if(x&&x.match(/^<pre/i)){x=w.body.firstChild.firstChild.nodeValue}o=qq.parseJson(x)}catch(u){g("Error when attempting to parse form upload response ("+u+")","error");o={success:false}}return o}function a(u){var o=qq.toElement('<iframe src="javascript:false;" name="'+u+'" />');o.setAttribute("id",u);o.style.display="none";document.body.appendChild(o);return o}function h(z,u){var y=d.paramsStore.getParams(z),x=d.demoMode?"GET":"POST",v=qq.toElement('<form method="'+x+'" enctype="multipart/form-data"></form>'),w=d.endpointStore.getEndpoint(z),o=w;y[d.uuidParamName]=f[z];if(!d.paramsInBody){o=qq.obj2url(y,w)}else{qq.obj2Inputs(y,v)}v.setAttribute("action",o);v.setAttribute("target",u.name);v.style.display="none";document.body.appendChild(v);return v}j={add:function(o){o.setAttribute("name",d.inputName);var u=c.push(o)-1;f[u]=qq.getUniqueId();if(o.parentNode){qq(o).remove()}return u},getName:function(o){return c[o].value.replace(/.*(\/|\\)/,"")},isValid:function(o){return c[o]!==undefined},reset:function(){qq.UploadHandler.prototype.reset.apply(this,arguments);c=[];f=[];i={}},getUuid:function(o){return f[o]},cancel:function(u){d.onCancel(u,this.getName(u));delete c[u];delete f[u];delete i[u];if(d.cors.expected){clearTimeout(p[u]);delete p[u];s.stopReceivingMessages(u)}var o=document.getElementById(u);if(o){o.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;");qq(o).remove()}},upload:function(x){var o=c[x],w=j.getName(x),u=a(x),v;if(!o){throw new Error("file with passed id was not added, or already uploaded or cancelled")}d.onUpload(x,this.getName(x));v=h(x,u);v.appendChild(o);n(u,function(z){g("iframe loaded");var y=z?z:e(u);q(x);if(!d.cors.expected){qq(u).remove()}if(!y.success){if(d.onAutoRetry(x,w,y)){return}}d.onComplete(x,w,y);m(x)});g("Sending upload request for "+x);v.submit();qq(v).remove();return x}};return j};qq.UploadHandlerXhr=function(I,v,n){var t=I,d=v,h=n,H=[],s="|",F=t.chunking.enabled&&qq.isFileChunkingSupported(),m=t.resume.enabled&&F&&qq.areCookiesEnabled(),z=w(),p=t.forceMultipart||t.paramsInBody,f;function l(T,S,o){var R=f.getSize(T),Q=f.getName(T);S[t.chunking.paramNames.partIndex]=o.part;S[t.chunking.paramNames.partByteOffset]=o.start;S[t.chunking.paramNames.chunkSize]=o.size;S[t.chunking.paramNames.totalParts]=o.count;S[t.totalFileSizeParamName]=R;if(p){S[t.chunking.paramNames.filename]=Q}}function u(o){o[t.resume.paramNames.resuming]=true}function O(o,R,Q){if(o.slice){return o.slice(R,Q)}else{if(o.mozSlice){return o.mozSlice(R,Q)}else{if(o.webkitSlice){return o.webkitSlice(R,Q)}}}}function N(W,T){var V=t.chunking.partSize,o=f.getSize(W),R=H[W].file||H[W].blobData.blob,U=V*T,S=U+V>=o?o:U+V,Q=C(W);return{part:T,start:U,end:S,count:Q,blob:O(R,U,S),size:S-U}}function C(R){var o=f.getSize(R),Q=t.chunking.partSize;return Math.ceil(o/Q)}function G(Q){var o=new XMLHttpRequest();H[Q].xhr=o;return o}function r(V,X,W,S){var U=new FormData(),o=t.demoMode?"GET":"POST",Y=t.endpointStore.getEndpoint(S),R=Y,Q=f.getName(S),Z=f.getSize(S),T=H[S].blobData;V[t.uuidParamName]=H[S].uuid;if(p){V[t.totalFileSizeParamName]=Z;if(T){V[t.blobs.paramNames.name]=T.name}}if(!t.paramsInBody){if(!p){V[t.inputName]=Q}R=qq.obj2url(V,Y)}X.open(o,R,true);if(t.cors.expected&&t.cors.sendCredentials){X.withCredentials=true}if(p){if(t.paramsInBody){qq.obj2FormData(V,U)}U.append(t.inputName,W);return U}return W}function A(S,R){var Q=t.customHeaders,o=H[S].file||H[S].blobData.blob;R.setRequestHeader("X-Requested-With","XMLHttpRequest");R.setRequestHeader("Cache-Control","no-cache");if(!p){R.setRequestHeader("Content-Type","application/octet-stream");R.setRequestHeader("X-Mime-Type",o.type)}qq.each(Q,function(T,U){R.setRequestHeader(T,U)})}function b(T,o,S){var Q=f.getName(T),R=f.getSize(T);H[T].attemptingResume=false;t.onProgress(T,Q,R,R);t.onComplete(T,Q,o,S);delete H[T].xhr;d(T)}function P(W){var R=H[W].remainingChunkIdxs[0],o=N(W,R),V=G(W),S=f.getSize(W),Q=f.getName(W),T,U;if(H[W].loaded===undefined){H[W].loaded=0}if(m&&H[W].file){q(W,o)}V.onreadystatechange=e(W,V);V.upload.onprogress=function(Z){if(Z.lengthComputable){var Y=Z.loaded+H[W].loaded,X=i(W,R,Z.total);t.onProgress(W,Q,Y,X)}};t.onUploadChunk(W,Q,K(o));U=t.paramsStore.getParams(W);l(W,U,o);if(H[W].attemptingResume){u(U)}T=r(U,V,o.blob,W);A(W,V);h("Sending chunked upload request for item "+W+": bytes "+(o.start+1)+"-"+o.end+" of "+S);V.send(T)}function i(o,U,W){var T=N(o,U),V=T.size,X=W-V,Y=f.getSize(o),Q=T.count,S=H[o].initialRequestOverhead,R=X-S;H[o].lastRequestOverhead=X;if(U===0){H[o].lastChunkIdxProgress=0;H[o].initialRequestOverhead=X;H[o].estTotalRequestsSize=Y+(Q*X)}else{if(H[o].lastChunkIdxProgress!==U){H[o].lastChunkIdxProgress=U;H[o].estTotalRequestsSize+=R}}return H[o].estTotalRequestsSize}function a(o){if(p){return H[o].lastRequestOverhead}else{return 0}}function B(T,Q,S){var R=H[T].remainingChunkIdxs.shift(),o=N(T,R);H[T].attemptingResume=false;H[T].loaded+=o.size+a(T);if(H[T].remainingChunkIdxs.length>0){P(T)}else{if(m){j(T)}b(T,Q,S)}}function M(Q,o){return Q.status!==200||!o.success||o.reset}function c(R){var o;try{o=qq.parseJson(R.responseText)}catch(Q){h("Error when attempting to parse xhr response text ("+Q+")","error");o={}}return o}function g(o){h("Server has ordered chunking effort to be restarted on next attempt for item ID "+o,"error");if(m){j(o);H[o].attemptingResume=false}H[o].remainingChunkIdxs=[];delete H[o].loaded;delete H[o].estTotalRequestsSize;delete H[o].initialRequestOverhead}function J(o){H[o].attemptingResume=false;h("Server has declared that it cannot handle resume for item ID "+o+" - starting from the first chunk","error");g(o);f.upload(o,true)}function y(S,o,R){var Q=f.getName(S);if(t.onAutoRetry(S,Q,o,R)){return}else{b(S,o,R)}}function D(R,Q){var o;if(!H[R]){return}h("xhr - server response received for "+R);h("responseText = "+Q.responseText);o=c(Q);if(M(Q,o)){if(o.reset){g(R)}if(H[R].attemptingResume&&o.reset){J(R)}else{y(R,o,Q)}}else{if(F){B(R,o,Q)}else{b(R,o,Q)}}}function K(o){return{partIndex:o.part,startByte:o.start+1,endByte:o.end,totalParts:o.count}}function e(Q,o){return function(){if(o.readyState===4){D(Q,o)}}}function q(Q,W){var T=f.getUuid(Q),S=H[Q].loaded,V=H[Q].initialRequestOverhead,X=H[Q].estTotalRequestsSize,U=k(Q),R=T+s+W.part+s+S+s+V+s+X,o=t.resume.cookiesExpireIn;qq.setCookie(U,R,o)}function j(Q){if(H[Q].file){var o=k(Q);qq.deleteCookie(o)}}function E(R){var S=qq.getCookie(k(R)),Q=f.getName(R),V,o,W,T,U,X;if(S){V=S.split(s);if(V.length===5){o=V[0];W=parseInt(V[1],10);T=parseInt(V[2],10);U=parseInt(V[3],10);X=parseInt(V[4],10);return{uuid:o,part:W,lastByteSent:T,initialRequestOverhead:U,estTotalRequestsSize:X}}else{h("Ignoring previously stored resume/chunk cookie for "+Q+" - old cookie format","warn")}}}function k(T){var R=f.getName(T),o=f.getSize(T),Q=t.chunking.partSize,S;S="qqfilechunk"+s+encodeURIComponent(R)+s+o+s+Q;if(z!==undefined){S+=s+z}return S}function w(){if(t.resume.id!==null&&t.resume.id!==undefined&&!qq.isFunction(t.resume.id)&&!qq.isObject(t.resume.id)){return t.resume.id}}function L(V,Q){var R=f.getName(V),o=0,U,T,S;if(!H[V].remainingChunkIdxs||H[V].remainingChunkIdxs.length===0){H[V].remainingChunkIdxs=[];if(m&&!Q&&H[V].file){U=E(V);if(U){T=N(V,U.part);if(t.onResume(V,R,K(T))!==false){o=U.part;H[V].uuid=U.uuid;H[V].loaded=U.lastByteSent;H[V].estTotalRequestsSize=U.estTotalRequestsSize;H[V].initialRequestOverhead=U.initialRequestOverhead;H[V].attemptingResume=true;h("Resuming "+R+" at partition index "+o)}}}for(S=C(V)-1;S>=o;S-=1){H[V].remainingChunkIdxs.unshift(S)}}P(V)}function x(U){var Q=H[U].file||H[U].blobData.blob,o=f.getName(U),T,S,R;H[U].loaded=0;T=G(U);T.upload.onprogress=function(V){if(V.lengthComputable){H[U].loaded=V.loaded;t.onProgress(U,o,V.loaded,V.total)}};T.onreadystatechange=e(U,T);S=t.paramsStore.getParams(U);R=r(S,T,Q,U);A(U,T);h("Sending upload request for "+U);T.send(R)}f={add:function(o){var Q;if(o instanceof File){Q=H.push({file:o})-1}else{if(o.blob instanceof Blob){Q=H.push({blobData:o})-1}else{throw new Error("Passed obj in not a File or BlobData (in qq.UploadHandlerXhr)")}}H[Q].uuid=qq.getUniqueId();return Q},getName:function(R){var Q=H[R].file,o=H[R].blobData;if(Q){return(Q.fileName!==null&&Q.fileName!==undefined)?Q.fileName:Q.name}else{return o.name}},getSize:function(Q){var o=H[Q].file||H[Q].blobData.blob;if(qq.isFileOrInput(o)){return o.fileSize!=null?o.fileSize:o.size}else{return o.size}},getFile:function(o){if(H[o]){return H[o].file||H[o].blobData.blob}},getLoaded:function(o){return H[o].loaded||0},isValid:function(o){return H[o]!==undefined},reset:function(){H=[]},getUuid:function(o){return H[o].uuid},upload:function(R,o){var Q=this.getName(R);t.onUpload(R,Q);if(F){L(R,o)}else{x(R)}},cancel:function(Q){var o=H[Q].xhr;t.onCancel(Q,this.getName(Q));if(o){o.onreadystatechange=null;o.abort()}if(m){j(Q)}delete H[Q]},getResumableFilesData:function(){var o=[],Q=[];if(F&&m){if(z===undefined){o=qq.getCookieNames(new RegExp("^qqfilechunk\\"+s+".+\\"+s+"\\d+\\"+s+t.chunking.partSize+"="))}else{o=qq.getCookieNames(new RegExp("^qqfilechunk\\"+s+".+\\"+s+"\\d+\\"+s+t.chunking.partSize+"\\"+s+z+"="))}qq.each(o,function(S,U){var T=U.split(s);var R=qq.getCookie(U).split(s);Q.push({name:decodeURIComponent(T[1]),size:T[2],uuid:R[0],partIdx:R[1]})});return Q}return[]}};return f};(function(e){var f,k,j,c,i,b,g,a,d,h;b=["uploaderType"];j=function(l){if(l){var m=a(l);g(m);if(i("uploaderType")==="basic"){f(new qq.FineUploaderBasic(m))}else{f(new qq.FineUploader(m))}}return k};c=function(l,n){var m=k.data("fineuploader");if(n){if(m===undefined){m={}}m[l]=n;k.data("fineuploader",m)}else{if(m===undefined){return null}return m[l]}};f=function(l){return c("uploader",l)};i=function(l,m){return c(l,m)};g=function(l){var m=l.callbacks={};e.each(new qq.FineUploaderBasic()._options.callbacks,function(q,p){var o,n;o=/^on(\w+)/.exec(q)[1];o=o.substring(0,1).toLowerCase()+o.substring(1);n=k;m[q]=function(){var r=Array.prototype.slice.call(arguments);return n.triggerHandler(o,r)}})};a=function(n,m){var o,l;if(m===undefined){if(n.uploaderType!=="basic"){o={element:k[0]}}else{o={}}}else{o=m}e.each(n,function(q,p){if(e.inArray(q,b)>=0){i(q,p)}else{if(p instanceof e){o[q]=p[0]}else{if(e.isPlainObject(p)){o[q]={};a(p,o[q])}else{if(e.isArray(p)){l=[];e.each(p,function(r,s){if(s instanceof e){e.merge(l,s)}else{l.push(s)}});o[q]=l}else{o[q]=p}}}}});if(m===undefined){return o}};d=function(l){return e.type(l)==="string"&&!l.match(/^_/)&&f()[l]!==undefined};h=function(n){var m=[],l=Array.prototype.slice.call(arguments,1);a(l,m);return f()[n].apply(f(),m)};e.fn.fineUploader=function(n){var m=this,l=arguments,o=[];this.each(function(p,q){k=e(q);if(f()&&d(n)){o.push(h.apply(m,l));if(m.length===1){return false}}else{if(typeof n==="object"||!n){j.apply(m,l)}else{e.error("Method "+n+" does not exist on jQuery.fineUploader")}}});if(o.length===1){return o[0]}else{if(o.length>1){return o}}return this}}(jQuery));